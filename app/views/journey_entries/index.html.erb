<div class="container-fluid dashboard">
  <div class="row">
    <div class="col-md-2 sidebar">
      <%= render "application/sidebar" %>
    </div>
    
    <div class="col-md-10 main">
      <h1 class="">Journeys</h1>

      <div class="row">

        <div class="col-md-10">

          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Your Contribution to Bath's Pollution</h3>
            </div>
            <div class="panel-body">
            <div id="chart" data-bath="7.0,6.9,9.5,14.5,18.2,21.5,25.2" data-you="<%= (Date.today.beginning_of_week..Date.today.end_of_week).to_a.map { |date| current_user.journey_entries.where(journey_date: date).map { |j| j.n2o }.inject{|sum,x| sum + x } || 0.0 }.to_s.gsub(/(\[|\])/, '') %>"></div>
            </div>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Journeys This Week</h3>
            </div>
            <div class="panel-body">
              <table class="table table-striped table-condensed">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Start Postcode</th>
                    <th>End Postcode</th>
                    <th>Distance</th>
                    <th>Transport</th>
                    <th>CO<sub>2</sub></th>
                    <th>CH<sub>4</sub></th>
                    <th>N<sub>2</sub>O</th>
                  </tr>
                </thead>
                <tbody>
                  <%= content_tag_for(:tr, @journies_this_week) do |journey| %>
                    <td><%= journey.journey_date.to_formatted_s(:long) %></td>
                    <td><%= journey.start_postcode.upcase %></td>
                    <td><%= journey.end_postcode.upcase %></td>
                    <td><%= journey.distance %> miles</td>
                    <td><%= journey.transport.name %></td>
                    <td><%= journey.co2.round(2) %>g</td>
                    <td><%= journey.ch4.round(2) %>g</td>
                    <td><%= journey.n2o.round(2) %>g</td>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Historical Journeys</h3>
            </div>
            <div class="panel-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Start Postcode</th>
                    <th>End Postcode</th>
                    <th>Distance</th>
                    <th>Transport</th>
                    <th>CO<sub>2</sub></th>
                    <th>CH<sub>4</sub></th>
                    <th>N<sub>2</sub>O</th>
                  </tr>
                </thead>
                <tbody>
                  <%= content_tag_for(:tr, @historical_journies) do |journey| %>
                    <td><%= journey.journey_date.to_default_s %></td>
                    <td><%= journey.start_postcode.upcase %></td>
                    <td><%= journey.end_postcode.upcase %></td>
                    <td><%= journey.distance %> miles</td>
                    <td><%= journey.transport.name %></td>
                    <td><%= journey.co2.round(2) %>g</td>
                    <td><%= journey.ch4.round(2) %>g</td>
                    <td><%= journey.n2o.round(2) %>g</td>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>

        </div>

        <div class="col-md-2">
          <%= link_to("Add Journey", journeys_new_path, :class => "btn btn-success") %>
        </div>
        
      </div> <!-- eo:row -->
    </div>
  </div>
</div>